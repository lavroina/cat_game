<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cat Catch TMA</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #eef2f3; cursor: url('https://cdn-icons-png.flaticon.com/32/1077/1077114.png'), auto; font-family: sans-serif; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .cat { position: absolute; width: 110px; height: auto; user-select: none; z-index: 10; }
        #basket { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 80px; pointer-events: none; }
        .portal-suck { transition: all 0.6s cubic-bezier(0.5, -0.5, 1, 1) !important; left: 50% !important; top: calc(100vh - 80px) !important; transform: translate(-50%, 0) scale(0) rotate(720deg) !important; opacity: 0; }
        .portal-escape { transition: all 0.8s ease-out !important; opacity: 1 !important; transform: scale(1) rotate(-360deg) !important; }
        #score { position: absolute; top: 20px; right: 20px; font-size: 20px; background: rgba(255,255,255,0.8); padding: 8px 15px; border-radius: 12px; z-index: 20; }
        #notification-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; }
        #notification { background: white; padding: 30px; border-radius: 20px; text-align: center; width: 85%; max-width: 400px; border: 4px solid #ff9a9e; }
        .btn { padding: 12px 20px; font-size: 16px; border: none; border-radius: 12px; cursor: pointer; margin: 8px; font-weight: bold; width: 80%; }
        .btn-main { background: #ff9a9e; color: white; }
        .btn-again { background: #a1c4fd; color: white; }
    </style>
</head>
<body>
<div id="game-container">
    <div id="score">üß∫ <span id="count">0</span> / 16</div>
    <div id="basket">üß∫</div>
</div>
<div id="notification-overlay">
    <div id="notification">
        <h2 style="font-size: 18px;">–ú–∏—Å—Ç–µ—Ä –≥–ª–∞–≤–Ω—ã–π –∫–æ—Ç–∏–∫, –ø—Ä–∏–≥–ª–∞—à–∞–µ–º –≤–∞—Å –≤ —Ä—ç—Å—Ç–æ—Ä–∞–Ω, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å–Ω—É—é –¥–∞—Ç—É –í–∞—à–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è. Veh</h2>
        <button class="btn btn-main" id="btn-ura">–£—Ä–∞</button>
        <button class="btn btn-again" onclick="location.reload()">–°—ã–≥—Ä–∞—Ç—å –µ—â–µ —Ä–∞–∑</button>
    </div>
</div>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();
    const container = document.getElementById('game-container');
    const countDisplay = document.getElementById('count');
    const overlay = document.getElementById('notification-overlay');
    let caughtCount = 0;
    const totalGoal = 16;
    const caughtCatsList = [];
    const baseImages = ['cat1.png', 'cat2.png', 'cat3.png', 'cat4.png', 'cat5.png', 'cat6.png', 'cat7.png', 'cat8.png', 'cat9.png', 'cat10.png'];
    const finalImages = [...baseImages];
    for (let i = 0; i < 6; i++) finalImages.push(baseImages[Math.floor(Math.random() * baseImages.length)]);

    class Cat {
        constructor(imgSrc) {
            this.el = document.createElement('img');
            this.el.src = imgSrc;
            this.el.className = 'cat';
            this.isCaught = false;
            this.resetPosition();
            this.el.onclick = () => this.catch();
            container.appendChild(this.el);
            this.update();
        }
        resetPosition() {
            this.x = Math.random() * (window.innerWidth - 110);
            this.y = Math.random() * (window.innerHeight - 150);
            // –°–Ω–∏–∂–∞–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ 12 –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –∏–≥—Ä—ã
            this.dx = (Math.random() - 0.5) * 12;
            this.dy = (Math.random() - 0.5) * 12;
            this.el.style.left = this.x + 'px';
            this.el.style.top = this.y + 'px';
        }
        update() {
            if (this.isCaught) return;
            this.x += this.dx; this.y += this.dy;
            if (this.x <= 0 || this.x >= window.innerWidth - 110) this.dx *= -1;
            if (this.y <= 0 || this.y >= window.innerHeight - 110) this.dy *= -1;
            this.el.style.left = this.x + 'px'; this.el.style.top = this.y + 'px';
            requestAnimationFrame(() => this.update());
        }
        catch() {
            if (this.isCaught) return;
            this.isCaught = true;
            caughtCount++;
            countDisplay.innerText = caughtCount;
            caughtCatsList.push(this);
            this.el.classList.add('portal-suck');
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            if (caughtCount === totalGoal) setTimeout(() => { overlay.style.display = 'flex'; }, 800);
        }
        escape() {
            if (!this.isCaught || caughtCount === totalGoal) return;
            this.isCaught = false;
            caughtCount--;
            countDisplay.innerText = caughtCount;
            this.el.classList.remove('portal-suck');
            this.el.classList.add('portal-escape');
            this.resetPosition();
            setTimeout(() => { this.el.classList.remove('portal-escape'); this.update(); }, 800);
        }
    }
    finalImages.forEach(src => new Cat(src));
    setInterval(() => {
        if (caughtCatsList.length > 0 && caughtCount < totalGoal) {
            const randomIndex = Math.floor(Math.random() * caughtCatsList.length);
            const escapingCat = caughtCatsList.splice(randomIndex, 1)[0];
            escapingCat.escape();
        }
    }, 15000);
    document.getElementById('btn-ura').onclick = () => {
        tg.showAlert('–£—Ä–∞, —á—Ç–æ–±—ã –Ω–∞–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∂–µ–Ω–µ', () => { tg.close(); });
    };
</script>
</body>
</html>
