<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cat Catch TMA</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #eef2f3; font-family: sans-serif; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .cat { position: absolute; width: 110px; height: auto; user-select: none; z-index: 10; }
        #basket { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 80px; pointer-events: none; }
        .portal-suck { transition: all 0.6s cubic-bezier(0.5, -0.5, 1, 1) !important; left: 50% !important; top: calc(100vh - 80px) !important; transform: translate(-50%, 0) scale(0) rotate(720deg) !important; opacity: 0; }
        #score { position: absolute; top: 20px; right: 20px; font-size: 20px; background: rgba(255,255,255,0.8); padding: 8px 15px; border-radius: 12px; z-index: 20; }
        #notification-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; justify-content: center; align-items: center; }
        #notification { background: white; padding: 30px; border-radius: 20px; text-align: center; width: 85%; max-width: 400px; border: 4px solid #ff9a9e; }
        .btn { padding: 15px 20px; font-size: 18px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; background: #ff9a9e; color: white; margin-top: 10px; }
    </style>
</head>
<body>
<div id="game-container">
    <div id="score">üß∫ <span id="count">0</span> / 16</div>
    <div id="basket">üß∫</div>
</div>
<div id="notification-overlay">
    <div id="notification">
        <h2 id="notif-text" style="font-size: 18px; line-height: 1.4; margin-bottom: 25px;">–ú–∏—Å—Ç–µ—Ä –≥–ª–∞–≤–Ω—ã–π –∫–æ—Ç–∏–∫, –ø–æ–¥–¥–∞–Ω–Ω—ã–µ –≤ —Å–±–æ—Ä–µ! –í—ã –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω—ã. üêæ</h2>
        <button class="btn" id="btn-next">–¢–∞–∫ –∏ –∑–Ω–∞–ª</button>
    </div>
</div>
<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const container = document.getElementById('game-container');
    const countDisplay = document.getElementById('count');
    const overlay = document.getElementById('notification-overlay');
    const notifText = document.getElementById('notif-text');
    const mainBtn = document.getElementById('btn-next');
    
    let caughtCount = 0;
    const totalGoal = 16;
    const baseImages = ['cat1.png', 'cat2.png', 'cat3.png', 'cat4.png', 'cat5.png', 'cat6.png', 'cat7.png', 'cat8.png', 'cat9.png', 'cat10.png'];
    const finalImages = [...baseImages];
    for (let i = 0; i < 6; i++) finalImages.push(baseImages[Math.floor(Math.random() * baseImages.length)]);

    class Cat {
        constructor(imgSrc) {
            this.el = document.createElement('img');
            this.el.src = imgSrc;
            this.el.className = 'cat';
            this.isCaught = false;
            this.resetPosition();
            this.el.onclick = () => this.catch();
            container.appendChild(this.el);
            this.update();
        }
        resetPosition() {
            this.x = Math.random() * (window.innerWidth - 110);
            this.y = Math.random() * (window.innerHeight - 150);
            this.dx = (Math.random() - 0.5) * 12;
            this.dy = (Math.random() - 0.5) * 12;
        }
        update() {
            if (this.isCaught) return;
            this.x += this.dx; this.y += this.dy;
            if (this.x <= 0 || this.x >= window.innerWidth - 110) this.dx *= -1;
            if (this.y <= 0 || this.y >= window.innerHeight - 110) this.dy *= -1;
            this.el.style.left = this.x + 'px'; this.el.style.top = this.y + 'px';
            requestAnimationFrame(() => this.update());
        }
        catch() {
            if (this.isCaught) return;
            this.isCaught = true;
            caughtCount++;
            countDisplay.innerText = caughtCount;
            this.el.classList.add('portal-suck');
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            if (caughtCount === totalGoal) setTimeout(() => { overlay.style.display = 'flex'; }, 800);
        }
    }
    finalImages.forEach(src => new Cat(src));

    let step = 1;
    mainBtn.onclick = () => {
        if (step === 1) {
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫–æ –≤—Ç–æ—Ä–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            notifText.innerText = "–ú–∏—Å—Ç–µ—Ä –≥–ª–∞–≤–Ω—ã–π –∫–æ—Ç–∏–∫, –ø—Ä–∏–≥–ª–∞—à–∞–µ–º –≤–∞—Å –≤ —Ä–µ—Å—Ç–æ—Ä–∞–Ω, —á—Ç–æ–±—ã –æ—Ç–º–µ—Ç–∏—Ç—å –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å–Ω—É—é –¥–∞—Ç—É –í–∞—à–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è. Veh";
            mainBtn.innerText = "–ò–¥—É";
            step = 2;
        } else if (step === 2) {
            // –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const finalMessage = "–ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —É–∂–∏–Ω –∂–¥—ë—Ç –≤ 18:30. ü•Ç –ñ–µ–Ω–∞ —É–∂–µ –∑–Ω–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω–µ–π –∑–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏. üêæü¶Ü";
            tg.showAlert(finalMessage, () => {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª –±–æ—Ç—É –≤ Replit –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º—Å—è
                tg.sendData("quest_complete");
                tg.close();
            });
        }
    };
</script>
</body>
</html>
